 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml">
 <head>
     <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
     <script src="../../global/global.js?aa" type="text/javascript"></script>
    <style type="text/css">
		.file-box{ position:relative;width:120px;}
		.webuploader-pick {
			position: relative;
		    display: inline-block;
		    width: 120px;
		    line-height: 24px;
		    height: 24px;
		    border: 1px solid #e1e1e1;
		    cursor: pointer;
		    background: #fff;
		    color: #333;
		    text-align: center;
		    overflow: hidden;
		    zoom: 1;
		}
   </style>
 </head>
 <body style="visibility:hidden;">
     <input class="mini-hidden" name="Shrink_row" id="Shrink_row" />
     <div class="mini-toolbar" style="border:0;">
         <table style="width:100%;">
             <tr>
                 <td style="width:100%;">
                     <a id="addUser" class="mini-button" iconCls="icon-add" style="font-weight: bold;" plain="true" text="新增" onclick="clickAddButtonByUser()" />
                     <a id="editUser" class="mini-button" iconCls="icon-edit" style="font-weight: bold;" plain="true" text="编辑" onclick="clickEditButtonByUser()" />
                     <a id="removeUser" class="mini-button" iconCls="icon-remove" style="font-weight: bold;" plain="true" text="删除" onclick="clickRemoveButtonByUser()" />
                     <a class="mini-button" iconCls="icon-reload" style="font-weight: bold;" plain="true" text="刷新" onclick="clickRefreshButtonUser()" />
                 </td>
                 <td style="white-space:nowrap;">
                     <input id="userComboboxField" class="mini-combobox" style="width:80px;" valueField="id" data="isUserFieldData" value="name" onitemclick="onComboboxFieldChanged" />
                     <input id="userSearchKeyWord" name="keyWord" class="mini-textbox" style="width: 150px;" onenter="clickQuickSearchByUser" onfocus="clearQuickSearchByUser" />
                     <a class="mini-button" iconCls="icon-search" style="font-weight: bold;" plain="true" onclick="clickQuickSearchByUser()">搜索</a>
                 </td>
             </tr>
         </table>
     </div>
     <div class="mini-fit" style="height:100px;">
         <div id="userDataGrid" class="mini-datagrid" style="width:100%;height:100%;" allowAlternating="true"  url=infoDomain+"/user/getUserList" idField="id" sizeList="[5,10,20,50]" pageSize="14" multiSelect="true">
             <div property="columns">
                 <div type="indexcolumn"></div>
                 <div type="checkcolumn"></div>
                 <div field="action" width="30" headerCls="fontweight" headerAlign="left" allowSort="false" renderer="onActionRenderer">查看</div>
                 <div field="name" width="100" headerCls="fontweight" headerAlign="left" allowSort="true">用户账户</div>
<!--                  <div field="pwd" width="100" headerCls="fontweight" headerAlign="left" allowSort="true">用户密码</div> -->
                 <div field="fullname" width="100" headerCls="fontweight" headerAlign="left" allowSort="true">真实姓名</div>
                 <div field="sex" width="100" headerCls="fontweight" headerAlign="left" allowSort="true" renderer="onSexRenderer">用户性别</div>
                 <div field="status" width="100" headerCls="fontweight" headerAlign="left" allowSort="true" renderer="onStatusRenderer">用户状态</div>
                 <div field="birthday" width="100" headerCls="fontweight" headerAlign="left" allowSort="false" dateFormat="yyyy-MM-dd">生日日期</div>
<!--                  <div field="sort" width="100" headerCls="fontweight" headerAlign="left" allowSort="true">排序数字</div> -->
                 <div field="createTime" width="100" headerCls="fontweight" headerAlign="left" allowSort="false" dateFormat="yyyy-MM-dd HH:mm:ss">创建时间</div>
<!--                  <div field="createBy" width="100" headerCls="fontweight" headerAlign="left" allowSort="true">创&nbsp;&nbsp;建&nbsp;人</div> -->
<!--                  <div field="updateTime" width="100" headerCls="fontweight" headerAlign="left" allowSort="false" dateFormat="yyyy-MM-dd HH:mm:ss">更新时间</div> -->
<!--                  <div field="updateBy" width="100" headerCls="fontweight" headerAlign="left" allowSort="true">更&nbsp;&nbsp;新&nbsp;人</div> -->
             </div>
         </div>
     </div>
     <!--弹出新增及编辑界面begin-->
     <div id="userAddOrEditWindow" class="mini-window" title="维护用户" style="width:710px;" showModal="true" allowResize="true" allowDrag="true">
         <div id="userAddOrEidthForm" class="form">
             <input class="mini-hidden" name="id" id="id" />
             <input class="mini-hidden" name="createBy" value="" />
             <table cellspacing="2" cellpadding="2" bordercolor="#DBE2E7" style="border-collapse:collapse;width: 680px;" border="1">
                 <tr>
                     <td style="width:150px;" align="right">用户账户<font color="red">*</font>：</td>
                     <td style="width:270px;">
                         <input id="name" name="name" class="mini-textbox" emptyText="请输入用户账户" required="true" style="width:100%" />
                     </td>
                     <td style="width:150px;" align="right">用户密码<font color="red">*</font>：</td>
                     <td style="width:270px;">
                         <input id="pwd" name="pwd" class="mini-password" emptyText="请输入用户密码" required="true" style="width:100%" />
                     </td>
                 </tr>
                 <tr>
                     <td style="width:150px;" align="right">真实姓名<font color="red">*</font>：</td>
                     <td style="width:270px;">
                         <input id="fullname" name="fullname" class="mini-textbox" emptyText="请输入真实姓名" required="true" style="width:100%" />
                     </td>
                     <td style="width:150px;" align="right">用户状态<font color="red">*</font>：</td>
                     <td style="width:270px;">
                         <input id="status" name="status" class="mini-combobox" emptyText="请输入用户状态" data="isStatusData" required="true" style="width:100%" />
                     </td>
                 </tr>
                 <tr>
                     <td style="width:150px;" align="right">用户性别<font color="red">*</font>：</td>
                     <td style="width:270px;">
                         <input id="sex" name="sex" class="mini-combobox" emptyText="请输入用户性别" data="isSexData"  required="true" style="width:100%" />
                     </td>
                     <td style="width:150px;" align="right">生日日期<font color="red">*</font>：</td>
                     <td style="width:270px;">
                         <input id="birthday" name="birthday" class="mini-datepicker" emptyText="请输入生日日期" required="true" style="width:100%" />
                     </td>
                 </tr>
                 <tr>
                     <td style="width:150px;" align="right">排序数字<font color="red">*</font>：</td>
                     <td colspan="3">
                         <input id="sort" name="sort" class="mini-spinner" emptyText="请输入排序数字" required="true" style="width:100%" />
                     </td>
                 </tr>
                  <tr>
                     <td style="width:150px;" align="right">用户说明<font color="red">*</font>：</td>
                     <td colspan="3">
                         <input id="comment" name="comment" class="mini-textarea"  style="width:100%" />
                     </td>
                 </tr>
                 <tr>
                     <td style="width:150px;" align="right">图片地址<font color="red">*</font>：</td>
                     <td colspan="3">
                         <input id="upload-img_name" name="imgName" class="mini-hidden"/>
                         <input id="upload-img_path" name="imgPath" class="mini-hidden"/>
                         <input id="upload-img_url" name="imgUrl" class="mini-hidden"/>
					     <img class="upload-img-show" src="../../..//images/imageError.GIF" width="120px;" height="100px;" id="add_busLicenceImg" />
					     <div class="file-box">
					         <div class="upload-box upload-img"></div>
					     </div>
                     </td>
                 </tr>
             </table>
             <div property="footer" align="center">
                 <a class="mini-button" onclick="userAddOrEditOnOk();" style="width:60px;">确定</a>
                 <a class="mini-button" onclick="userAddOrEditOnCancel();" style="width:60px;">取消</a>
             </div>
         </div>
     </div>
     <!--弹出新增及编辑界面end-->
     <!--弹出查询界面begin-->
     <div id="userSearchWindow" class="mini-window" title="用户查询" style="width:500px;" showModal="true" allowResize="true" allowDrag="true">
         <div id="userSearchForm" class="form">
             <table style="width:100%;" cellpadding="3" cellspacing="3">
                 <tr>
                     <td width="20%;" align="right">用户账户：</td>
                     <td width="30%;">
                         <input name="name" class="mini-textbox" style="width: 160px;" />
                     </td>
                      <td width="20%;" align="right">真实姓名：</td>
                     <td width="30%;">
                         <input name="fullname" class="mini-textbox" style="width: 160px;" />
                     </td>
                 </tr>
                 <tr>
                     <td width="20%;" align="right">用户性别：</td>
                     <td width="30%;">
                         <input name="sex" class="mini-combobox"  data="isSexData"  style="width:160px" />
                     </td>
                     <td width="20%;" align="right">用户状态：</td>
                     <td width="30%;">
                         <input name="status" class="mini-combobox" data="isStatusData" style="width:160px" />
                     </td>
                 </tr>
             </table>
             <div property="footer" align="center">
                 <a class="mini-button" onclick="userSerchOnOk();" style="width:60px; font-weight:bold;">确定</a>
                 <a class="mini-button" onclick="userSerchOnCancel();" style="width:60px; font-weight:bold;">取消</a>
             </div>
         </div>

     </div>
     <!--弹出查询界面end-->
     <!--弹出显示详情界面start-->
     <div id="userViewForm" style="display:none;padding:5px;position:relative;background: none repeat scroll 0 0">
         <div id="readOnlyUserViewForm" class="form">
             <table border="1" cellspacing="0" width="100%" style="border-collapse:collapse;">
                 <tr>
                     <td style="width:150px;" align="right">用户账户：</td>
                     <td style="width:270px;">
                         <input id="view_name" name="name" class="mini-textbox" style="width:80%" />
                     </td>
                     <td style="width:150px;" align="right">用户密码：</td>
                     <td style="width:270px;">
                         <input id="view_pwd" name="pwd" class="mini-textbox" style="width:80%" />
                     </td>
                 </tr>
                 <tr>
                     <td style="width:150px;" align="right">真实姓名：</td>
                     <td style="width:270px;">
                         <input id="view_fullname" name="fullname" class="mini-textbox" style="width:80%" />
                     </td>
                     <td style="width:150px;" align="right">用户状态：</td>
                     <td style="width:270px;">
                          <input id="view_status" name="status" class="mini-combobox" data="isStatusData" style="width:80%" />
                     </td>
                 </tr>
                 <tr>
                     <td style="width:150px;" align="right">用户性别：</td>
                     <td style="width:270px;">
                         <input id="view_sex" name="sex" class="mini-combobox" data="isSexData"  style="width:80%" />
                     </td>
                     <td style="width:150px;" align="right">生日日期：</td>
                     <td style="width:270px;">
                         <input id="view_birthday" name="birthday" class="mini-datepicker" style="width:80%" />
                     </td>
                 </tr>
                 <tr>
                     <td style="width:150px;" align="right">创建时间：</td>
                     <td style="width:270px;">
                         <input id="view_createTime" name="createTime" class="mini-datepicker" style="width:80%" />
                     </td>
                     <td style="width:150px;" align="right">创&nbsp;&nbsp;建&nbsp;人：</td>
                     <td style="width:270px;">
                         <input id="view_createName" name="createName" class="mini-textbox" style="width:80%" />
                     </td>
                 </tr>
                 <tr>
                     <td style="width:150px;" align="right">更新时间：</td>
                     <td style="width:270px;">
                         <input id="view_updateTime" name="updateTime" class="mini-datepicker" style="width:80%" />
                     </td>
                     <td style="width:150px;" align="right">更&nbsp;&nbsp;新&nbsp;人：</td>
                     <td style="width:270px;">
                         <input id="view_updateName" name="updateName" class="mini-textbox" style="width:80%" />
                     </td>
                 </tr>
                  <tr>
                     <td style="width:150px;" align="right">排序数字：</td>
                     <td colspan="31">
                         <input id="view_sort" name="sort" class="mini-textbox" style="width:80%" />
                     </td>
                 </tr>
                  <tr>
                     <td style="width:150px;" align="right">用户说明：</td>
                     <td colspan="31">
                          <input id="view_comment" name="comment" class="mini-textbox"  style="width:80%" />
                     </td>
                 </tr>
             </table>
         </div>
     </div>
     <script type="text/javascript">
     document.body.style.visibility = "visible";
     var isUserFieldData = [
         {
             id: 'name'
             , text: '用户账户'
         }, {
             id: 'fullname'
             , text: '真实姓名'
         }, {
             id: 'moreFilter'
             , text: '更多筛选'
         }];
     var isSexData = [{ id: '', text: '请选择'},{ id: 0, text: '男' }, { id:1, text: '女'}];
     var isStatusData = [{ id: '0', text: '启用' }, { id:'1', text: '停用'}];
     mini.parse();
     var userDataGrid = mini.get("userDataGrid");
     userDataGrid.load();
     </script>
     <script type="text/javascript">
     //新增相关方法
     function clickAddButtonByUser() {
             _add_function('userAddOrEditWindow', 'userAddOrEidthForm', '新增用户');
         }
     //编辑相关方法
     function clickEditButtonByUser() {
             var ajaxurl = infoDomain+"/user/getUserById";
             _edit_function('userDataGrid', 'userAddOrEditWindow', 'userAddOrEidthForm', '编辑用户', ajaxurl,"clickEditButtonByUserSuccess", null, null);
     }
     function clickEditButtonByUserSuccess(obj){
     	var data=obj.data;
     	//$(".upload-img-show").attr("src",data.imgUrl);
     }
         //删除相关方法
     function clickRemoveButtonByUser() {
         var ajaxurl = infoDomain+"/user/deleteUserById";
         _delete_function('userDataGrid', ajaxurl, backFunction, null, null, null, null);
     }

     //刷新相关方法
     function clickRefreshButtonUser() {
         _refresh_function('userDataGrid', null);
     }

     //确定相关方法
     function userAddOrEditOnOk() {
         var ajaxurl = infoDomain+"/user/" + (_add_action('id') ? 'saveUser' : 'updateUser');
         _save_function('userAddOrEidthForm', ajaxurl, backFunction, null, null);
     }

     //取消相关方法
     function userAddOrEditOnCancel() {
             _cancel_function('userAddOrEditWindow');
         }
         //执行完毕调用的方法   
     function backFunction() {
             userAddOrEditOnCancel();
             clickRefreshButtonUser();
         }
         //查询相关方法begin
     function clickSearchButtonByUser() {
         _search_function('userSearchWindow', 'userSearchForm', '用户查询');
     }

     function userSerchOnOk() {
         userSearch();
     }

     function userSerchOnCancel() {
         _cancel_function('userSearchWindow');
     }

     function userSearch() {
         //         	var createTime_begin = mini.get("createTime_begin").getValue();
         //         	createTime_begin = mini.formatDate(createTime_begin,"yyyy-MM-dd");
         // 			var createTime_end = mini.get("createTime_end").getValue();
         // 			createTime_end = mini.formatDate(createTime_end,"yyyy-MM-dd");
         var form = new mini.Form("#userSearchForm");
         var o = form.getData();
         userDataGrid.load(o, userSearchSuccse, _search_Fail);
     }

     function userSearchSuccse() {
         _cancel_function('userSearchWindow');
     }

     function showView(_uid) {
         editRow(_uid);
     }

     function editRow(row_uid) {
        editRowInfo('userDataGrid','userViewForm','readOnlyUserViewForm',infoDomain+'/user/getUserById',row_uid);
     }
     userDataGrid.on("rowdblclick", function (e) { //点击行显示详细信息
         var record = e.record;
         var _uid = record._uid;
         editRow(_uid);
     });

     function onComboboxFieldChanged(e) {
         var filed = mini.get("userComboboxField").getValue();
         if ("moreFilter" == filed) {
             clickSearchButtonByUser();
         }
     }

     function clickQuickSearchByUser() {
         var __fieldName = mini.get("userComboboxField").getValue();
         var __fieldValue = mini.get("userSearchKeyWord").getValue();
         __fieldValue=encodeURIComponent(__fieldValue);
         if (!isEmpty(__fieldName, false) && !isEmpty(__fieldValue, false)) {
             var filterJsonStr = "{'" + __fieldName + "':'" + __fieldValue + "'}";
             var filterJsonObj = mini.decode(filterJsonStr, true);
             userDataGrid.load(filterJsonObj);
         } else {
             userDataGrid.load();
         }
     }

     function clearQuickSearchByUser(e) {
         mini.get("userSearchKeyWord").setValue();
     }
   
     //渲染用户性别
     function onSexRenderer(e) {
     	 var sexName="女";
         var grid = e.sender;
         var record = e.record;
         var sex = record.sex;
         //return onDefaultRenderer('sex',sex,'id','text');
         if("0"==sex){
         	sexName="男";
         }else if("1"==sex){
         	sexName="女";
         }
         return sexName;
     }
     //用户状态渲染
     function onStatusRenderer(e) {
      	  var statusName="";
          var record=e.record;
          var status=record.status
          if("0"==status){
          	statusName="启用";
          }else if("1"==status){
          	statusName="<font color='red'>停用</font>";
          }
          return statusName;
      }
     </script>
     <script type="text/javascript">
		function img_upload(o) {
				var url = "<%=path%>/uploadImage/uploadTmepImg";
				var htmlo = {"viewdivid":"adDIV", "uploaddivid":"uploadDIV", "deletedivid":"subDIV", "fullurlid":"fullPath", "valueid":"adImgUrl", "deleteimgid":"subImgsUpload"};
				var paramo = {};
				_img_upload(o, url, htmlo, paramo);
	    }

	</script>
 </body>
 </html>